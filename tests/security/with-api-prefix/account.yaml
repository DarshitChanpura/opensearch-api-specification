$schema: ../../../json_schemas/test_story.schema.yaml

description: Test account endpoint.

# prologues:
#   - path: /_plugins/_security/api/internalusers/{username}
#     method: PUT
#     parameters:
#       username: test
#     request:
#       payload:
#         password: myWeakPassword123!
#         opendistro_security_roles: []
#         backend_roles: []
#         attributes: {}
#     status: [200]
chapters:
  - synopsis: Get account details.
    path: /_plugins/_security/api/account
    method: GET
    response:
      status: 200
      payload:
        user_name: admin
        is_reserved: true
        is_hidden: false
        is_internal_user: true
        user_requested_tenant: null
        backend_roles:
          - admin
        custom_attribute_names: []
        tenants:
          global_tenant: true
          admin_tenant: true
          admin: true
        roles:
          - own_index
          - all_access
  # TODO: following test can be changed to interact with test user once https://github.com/opensearch-project/opensearch-api-specification/issues/438 is implemented
  # NOTE: this test should be updated to change test user's password created in epilogue. Until then this will be 403 since admin is a reserved user.
  - synopsis: Change password.
    path: /_plugins/_security/api/account
    method: PUT
    request:
      payload:
        current_password: myStrongPassword123!
        password: myWeakPassword123!
    response:
      status: 403
# epilogues:
#   - path: /_plugins/_security/api/account
#     method: PUT
#     request:
#       payload:
#         current_password: myWeakPassword123!
#         password: myStrongPassword123!
#     status: [200]
#   - path: /_plugins/_security/api/internalusers/{username}
#     method: DELETE
#     parameters:
#       username: test
#     status: [200, 404]
